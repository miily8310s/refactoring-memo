# 第１章 リファクタリング- 最初の例

## 着手前のコメント

### コードの問題点

- 演劇の分類方法と料金系のルール変更に対処するためには、`statement`関数を書き換える必要がある
- さらにルールが複雑化した場合、どこを変更すべきかがますますわかりにくくなり、誤りなく実施することも困難になる
  - → リファクタリングへの原動力

### リファクタリングへの流れ

- コードの動作を理解して、流れを追わなければならない状況になったときには、行動を起こす必要がある
- ※コードを今後変更する予定がないなら、放置しても問題ない

## リファクタリングの第一歩

- リファクタリングを行うとき常に最初にすること： 対象となるコードに対してテスト群を作ること
  - プログラムが大きくなるほど、加えた変更が意図せず他の部分を壊してしまう可能性があるため
  - テストは思わぬ間違いから守ってくれるバグ発券器のようなもの
- `statement`関数の戻り値は文字列
  - 請求明細をいくつか作り、明細ごとにさまざまな種類の演劇が含まれるように → 請求書の文字列を生成
  - 想定される正しい結果の文字列と比較
- テストフレームワークを使って、開発環境のコマンド一つでまとめて実行できるようにする
- コードそのものとテストコードの２回書く
- テストの作成には時間がかかるが、後のデバッグの時間が減り、ずっと得できる
