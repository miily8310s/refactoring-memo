# 第２章 リファクタリングの原則

## リファクタリングの定義

- 「リファクタリング」という用語は名詞、もしくは動詞として使われている
- 名詞として
  - 外部から見たときの振る舞いを保ちつつ、理解や修正が簡単になるように、ソフトウェアの内部構造を変化させること
  - 名前のついたリファクタリングがこれに該当
- 動詞として
  - 一連のリファクタリングを適用して、外部から見たふるまいの変更なしに、ソフトウェア再構築すること
- リファクタリングは
  - 振る舞いを保ちつつ小さなステップを適用していくもの
  - コードを「理解や修正が容易になるように」変化させていくもの
- 個々のリファクタリングは非常に小さいステップでできている
  - その結果、コードが壊れている状態は非常に短く、いつでも中断が可能
- リファクタリング中に気がついたバグは、リファクタリング後も残っているべき

## 二つの帽子

- リファクタリングを実施する際は、作業を二つの活動に区分すべき
- 二つの活動 = 機能追加 / リファクタリング
- 機能追加を行うときは、既存のコードを変更してはいけない
- リファクタリングでは、
  - 逆に機能追加は行わないようにする
  - テストの追加はしない
- 重要なのは、どちらの帽子をかぶっているか、およびプログラミングの仕方のちょっととした違いを、常に意識しておくこと

## リファクタリングを行う理由

- リファクタリングがすべてのソフトウェアの問題を解決してくれるわけではない
- リファクタリングを行うべき理由として次のものがある
  1. ソフトウェア設計を改善する
  2. ソフトウェアを理解しやすくする
  3. バグの発見を助ける
  4. プログラミングを速める

### リファクタリングはソフトウェア設計を改善する

- リファクタリングなしでは、プログラム内部の設計（アーキテクチャ）は徐々に劣化していく
- 設計のまずいコードでは、良いものに比べ、、同じ処理をするのにも余計にコードを書くことになる
- 重複したコードを排除することは、設計を改善するための重要事項と言える

### リファクタリングはソフトウェアを理解しやすくする

- プログラミングとは、コンピュータとの対話と言える
- 何をさせたいかを正確に表現できるかがすべて
- しかし、ソースコードには、他の利用者がいることを忘れてはいけない
- プログラムを動作させることに必死で、将来の開発者のことを考えないのは問題
- 少しの時間をリファクタリングに充てるだけで、コードの目的がより伝わるようになり、実現したいことを明確に表現できるようになる

### リファクタリングはバグの発見を助ける

- コードが理解しやすいこと = バグを見つけやすい
- プログラムの構造を構造を明確にすることで、コードに対する推測が正しかったことがわかり、やがてバグを無理なく発見できるに至る

### リファクタリングはプログラミングを速める

- システムに長く携わっている開発者から、当初はすぐ開発できたけど、今では機能の追加に時間がかかるようになった話を聞く
  - 既存コードに新機能をどう適合させるかを把握する時間が、徐々に増えていく
  - 追加できても、バグが起こり、修正にさらに時間がかかるようになる
  - ついに白紙の状態から作り直せればと願うようになる
- しかし逆に新機能の追加スピードが「より早く」なっているチームもある
- この２チームの違いは、ソフトウェアの内部的な品質により生じている
- 内部の設計が優れているソフトウェアは、新たな機能を加える際にどこをどのように変更すればよいか、すぐに把握できる
- 「デザインスタミナ仮設」
  - 内部の設計を入念に行えば、ソフトウェアハイ初のためのスタミナを付けていくことができ、より長く、より速いペースで開発できる
- すぐれた設計を前もって完了しておくことは非常に難しいので、すばやく機能を追加し続けるには、リファクタリングが不可欠

## いつリファクタリングすべきか
